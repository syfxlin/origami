/*!
 * SMValidator 1.2.7
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 * Released under the MIT License.
 */!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.SMValidator=r()}(this,function(){"use strict";function e(e,r,t){p?e.attachEvent("on"+r,t):e.addEventListener(r,t)}function r(e){return"checkbox"===e||"radio"===e}function t(e){return"string"==typeof e}function n(e,r){return g.call(e,r)}function s(e,r){var t=this;r||(r={});for(var s=d.length-1;s>=0;s--){var a=d[s];t[a]=n(r,a)?r[a]:_[a]}if(t.fields={},t.rules=r.rules||{},e){t.submit=r.submit;for(var l in r.fields)t.fields[l]=t.parseField(r.fields[l]);t.queryInput(e)}}function a(e,r){if(e)for(var t=e.length-1;t>=0;t--){for(var n=e[t],s=n.target,a=n.className.split(" "),l=s.className?s.className.split(" "):[],i=a.length-1;i>=0;i--){var u=a[i],o=l.indexOf(u);!r&&o>-1?l.splice(o,1):r&&o===-1&&l.push(u)}s.className=l.join(" ")}}function l(e,r,t){if(e)for(var n=e.length-1;n>=0;n--){var s=e[n];s.keep?r||s.quiet||(s.dom.innerHTML=""):s.dom.style.display=r?"":"none",t&&!s.quiet&&(s.dom.innerHTML=t)}}function i(e,r){if(r)for(var t in r)e.style[t]=r[t]}function u(e){var r=e._sm;i(e,r.style),l(r.failHtml,!1),l(r.passHtml,!1),a(r.failCss,!1),a(r.passCss,!1)}function o(e,t){var n=e.type,s=e.name,o=e._sm,f=o.rule,c=!0,p=[],m=1,g="",d="|"===f.token;if(r(n)&&e.form)for(var h=e.form.elements[s],v=h.length-1;v>=0;v--)h[v].checked&&(g+=" ");else if("select-multiple"===n)for(var h=e.children,v=h.length-1;v>=0;v--)h[v].selected&&h[v].value&&(g+=" ");else g=e.value;if(t&&"number"==typeof t.forceFlag)m=t.forceFlag,f.async&&(o.asyncFlag=m,t.asyncMessage&&(o.asyncMessage=t.asyncMessage),2===m&&(c=o.asyncMessage||"no asyncMessage!"));else if(f.async)f.required&&!g?(m=2,c=f.required):"number"==typeof o.asyncFlag?(m=o.asyncFlag,2===m&&(c=o.asyncMessage||"no asyncMessage!")):g?(m=2,c=f.async):m=0;else if(g)for(var v=f.rules.length-1;v>=0;v--){var y=f.rules[v],_=y.rule;if(_ instanceof RegExp){if(!_.test(g)){if(c=y.message,m=2,d)break;p.push(c)}}else if(c=y.params?_.apply(null,[g].concat(y.params)):_.call(null,g),c!==!0){if(m=2,d)break;p.push(c)}}else f.required?(m=2,c=f.required,d||p.push(c)):m=0;return d||(m=p.length?2:1),u(e),1===m?(a(o.failCss,!1),a(o.passCss,!0),i(e,f.passStyle),l(o.passHtml,!0),f.pass&&f.pass.call(e)):2===m&&(a(o.passCss,!1),a(o.failCss,!0),i(e,f.failStyle),l(o.failHtml,!0,d?c:p.join("<br/>")),f.fail&&f.fail.call(e,d?c:p)),2===m&&b&&(e.scrollIntoView(),b=!1),2!==m}function f(e,r){for(var t=0;t<r.length;t++)e=e.replace("{"+t+"}",r[t]);return e}var c=window.document,p=!c.addEventListener;if(p)Array.prototype.indexOf=function(e){for(var r=0,t=this.length;r<t;r++)if(this[r]===e)return r;return-1},Object.defineProperty(Element.prototype,"nextElementSibling",{get:function(){for(var e=this.nextSibling;e&&1!==e.nodeType;)e=e.nextSibling;return e}});else{var m=!0;c.addEventListener("compositionstart",function(e){m=!1}),c.addEventListener("compositionend",function(e){m=!0;var r=c.createEvent("HTMLEvents");r.initEvent("input",!0,!0),e.target.dispatchEvent(r)}),c.addEventListener("input",function(e){if(m){var r=e.target;r._sm&&!r._sm.rule.disinput&&o(r)}})}e(c,"change",function(e){var t=e.target;r(t.type)&&t._sm&&!t._sm.rule.manul&&o(t)});var g=Object.prototype.hasOwnProperty,d=["required","async","short","disinput","disblur","focus","manul","failHtml","passHtml","failStyle","failCss","passStyle","passCss"],h=d.slice(3),v=s.prototype;v.queryInput=function(r){for(var t=this,n=[],a=c.querySelectorAll(r),l=a.length-1;l>=0;l--){var i=a[l],u=i.tagName;if("FORM"===u){i.novalidate="novalidate";for(var o=[],f=i.length-1;f>=0;f--)t.bindInput(i[f])&&o.push(i[f]);n=n.concat(o),t.submit&&o.length&&(i._smInputs=o,e(i,"submit",function(e){e.preventDefault();var r=e.target||e.srcElement,n=s.validate(r._smInputs,{locate:!0,"short":t["short"]});t.submit(n,r)}))}else"INPUT"!==u&&"SELECT"!==u&&"TEXTAREA"!==u||t.bindInput(i)&&n.push(i)}return n},v.bindInput=function(t){if(t._sm)return!0;var s=this,a=t.getAttribute("name"),l=t.getAttribute("data-rule"),i=l?this.parseString(l):this.fields[a];if(i){if(t._sm={rule:i,flag:0},!i._isInit){i._isInit=!0,s.handleProperty(i,"required"),s.handleProperty(i,"async"),i.async&&(i.manul=!0);for(var f=h.length-1;f>=0;f--){var m=h[f];n(i,m)||(i[m]=this[m])}s.handleStyle(i,"failStyle"),s.handleStyle(i,"passStyle")}s.recordStyle(t,i.failStyle),s.recordStyle(t,i.passStyle);var g=t._sm;if(r(t.type)){for(var d=c.querySelectorAll('input[name="'+a+'"]'),f=d.length-1;f>=0;f--)d[f]!==t&&(d[f]._sm=g);i.disblur=i.disinput=!0,i.focus=!1}else t.style.borderImage||(g.style||(g.style={}),g.style.borderImage="");return s.handleHtml(t,"failHtml",i),s.handleHtml(t,"passHtml",i),s.handleCss(t,"failCss",i.failCss),s.handleCss(t,"passCss",i.passCss),i.manul&&(i.disblur=i.disinput=!0),i.focus&&e(t,"focus",function(e){u(e.target||e.srcElement)}),i.disblur||e(t,"blur",function(e){o(e.target||e.srcElement)}),p&&!i.disinput&&t.attachEvent("onpropertychange",function(e){"value"===e.propertyName&&o(e.srcElement)}),!0}return!1},v.handleProperty=function(e,r){n(e,r)?e[r]===!0&&(e[r]=this[r]):e[r]=!1},v.handleStyle=function(e,r){if(t(e[r]))try{e[r]=JSON.parse(e[r].replace(/'/g,'"'))}catch(n){console.error("error json format: "+e[r])}},v.recordStyle=function(e,r){if(r){e._sm.style||(e._sm.style={});var t=e._sm.style;for(var n in r)t[n]||(t[n]=e.style[n])}},v.handleHtml=function(e,r,n){var s=n[r];if(s){e._sm[r]=[],t(s)&&(s=[s]);for(var a=0;a<s.length;a++){var l,i=s[a],u={};if(0===i.indexOf("*")&&(i=i.substring(1),u.keep=!0),0===i.indexOf("!")&&(i=i.substring(1),u.quiet=!0),i.indexOf("<")>-1){for(var o=e;0===i.indexOf("+");)i=i.substring(1),o=o.parentNode;var f=c.createElement("div");f.innerHTML=i,l=f.children[0],o.parentNode.insertBefore(l,o.nextElementSibling)}else l=c.querySelector(i);l&&(u.dom=l,e._sm[r].push(u),u.keep||(l.style.display="none"))}}},v.handleCss=function(e,r,n){if(n){t(n)&&(n=[n]),e._sm[r]=[];for(var s=n.length-1;s>=0;s--){for(var a=n[s],l=e;0===a.indexOf("+");)a=a.substring(1),l=l.parentNode;e._sm[r].push({target:l,className:a})}}},v.parseRule=function(e,r){var t=e.name,n=this.rules[t]||_.rules[t];n&&(n instanceof Array?r.rules.push({rule:n[0],message:n[1]}):r.rules.push({rule:n,params:e.params}))},v.parseStringFunction=function(e){var r={name:e},t=e.indexOf("(");return t>0&&(r.name=e.substring(0,t),e.indexOf("{")>-1?r.params=e.substring(t+1,e.length-1):r.params=e.substring(t+1,e.length-1).split(",")),r},v.parseString=function(e){var r={rules:[]},t=e.indexOf("&")>-1?"&":"|",n=e.split(t);r.token=t;for(var s=n.length-1;s>=0;s--){var a=n[s];if(a)if(0===a.indexOf("/")){var l=a.substring(1).split("/");2===l.length?r.rules.push({rule:new RegExp(l[0]),message:l[1]}):3===l.length&&r.rules.push({rule:new RegExp(l[0],"i"),message:l[2]})}else{var i=this.parseStringFunction(a),u=i.name,o=!0;if("!"===u.charAt(0)&&(u=u.substring(1),o=!1),d.indexOf(u)>-1){var f=i.params;f?r[u]=f:r[u]=o}else this.parseRule(i,r)}}return r},v.parseField=function(e){if(e instanceof Array)return{rules:[{rule:e[0],message:e[1]}]};if(e instanceof Function)return{rules:[{rule:e}]};if(t(e))return this.parseString(e);if("object"==typeof e){if(e.token="|",e.rule instanceof Array)e.rules=[{rule:e.rule[0],message:e.rule[1]}];else if(e.rule instanceof Function)e.rules=[{rule:e.rule}];else if(t(e.rule)){var r=e.rule;delete e.rule,r.indexOf("&")>-1&&(e.token="&");var n=r.split(e.token);e.rules=[];for(var s=n.length-1;s>=0;s--)n[s]&&this.parseRule(this.parseStringFunction(n[s]),e)}return e}};var y,b,_={async:"not been validated by async",required:"this is required",rules:{}};s.config=function(e){for(var r=d.length-1;r>=0;r--){var t=d[r];n(e,t)&&(_[t]=e[t])}if(e.rules)for(var a in e.rules)_.rules[a]=e.rules[a];y=new s},s.validate=function(e,r){var n=t(e)?y.queryInput(e):e,s=0,a=0,l=!1;r&&(b=r.locate,l=r["short"]);for(var i=n.length-1;i>=0;i--){var u=n[i];if(u._sm)if(a++,o(u,r))s++;else if(l)return!1}return a===s},s.reset=function(e){for(var r=t(e)?y.queryInput(e):e,n=r.length-1;n>=0;n--)u(r[n])};var S={number:"only number",names:"wrong name format",email:"wrong email format",range_equal:"value must be equal to {0}",range_scope:"value must be greater than {0} and less than {1}",range_greater:"value must be greater than {0}",range_less:"value must be less than {0}",range_no_number:"value must be number",error_param:"error param",length_equal:"length must be equal to {0}",length_scope:"length must be greater than {0} and less than {1}",length_greater:"length must be greater than {0}",length_less:"length must be less than {0}",password:"passwords don't match"};s.config({failHtml:'<span style="color:#c00;"></span>',failStyle:{color:"#c00",border:"1px solid #c00"},rules:{number:function(e){return/^-?\d+(\.{1}\d+)?$/.test(e)||S.number},names:function(e){return/^(\w+[\-']?\w+\s?)+$/i.test(e)||S.names},email:function(e){return/^[\w\+\-]+(\.[\w\+\-]+)*@[a-z\d\-]+(\.[a-z\d\-]+)*\.([a-z]{2,4})$/i.test(e)||S.email},range:function(e,r,t){e=1*e;var n=/^-?\d+(\.{1}\d+)?$/;return n.test(e)?r&&!n.test(r)&&t&&!n.test(t)?S.error_param:2===arguments.length?e==r||f(S.range_equal,[r]):3===arguments.length?r&&t?e>r&&e<t||f(S.range_scope,[r,t]):r?e>r||f(S.range_greater,[r]):t?e<t||f(S.range_less,[t]):S.error_param:void 0:S.range_no_number},length:function(e,r,t){var n=e.length;return 2===arguments.length?n==r||f(S.length_equal,[r]):3===arguments.length?r&&t?n>r&&n<t||f(S.length_scope,[r,t]):r?n>r||f(S.length_greater,[r]):t?n<t||f(S.length_less,[t]):S.error_param:void 0},equal:function(e,r){var t=c.querySelector(r);return e===t.value||S.password}}}),s.setLang=function(e){for(var r in e)S[r]=e[r]};var q={bootstrap:{failStyle:!1,failHtml:['!<span class="glyphicon glyphicon-remove form-control-feedback"></span>','<small class="help-block"></small>'],failCss:"++has-error has-feedback",passHtml:'<span class="glyphicon glyphicon-ok form-control-feedback"></span>',passCss:"++has-success has-feedback"},semantic:{failStyle:!1,failHtml:['!<i class="remove icon"></i>','+<small class="ui red pointing label"></small>'],failCss:"++error",passHtml:'<i class="checkmark icon"></i>'}};return s.setSkin=function(e){s.config(q[e])},s});